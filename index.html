<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JISP Web Server</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #1e1e1e;
            color: #d4d4d4;
            margin: 10px;
        }
        h1 {
            color: #d4d4d4;
        }
        p {
            color: #d4d4d4;
        }
        button {
            background-color: #333;
            color: #d4d4d4;
            border: 1px solid #555;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover {
            background-color: #555;
        }
        #json-renderer {
            border: 1px solid #3c3c3c;
            padding: 5px;
            margin-top: 10px;
            white-space: pre-wrap; /* Allow long strings to wrap */
            font-family: monospace;
            background-color: #252526;
            color: #d4d4d4;
            border-radius: 4px;
        }
        .json-object, .json-array {
            padding-left: 15px;
            border-left: 1px solid #444;
            margin: 2px 0;
            padding-top: 2px;
            padding-bottom: 2px;
            border-radius: 2px;
            position: relative;
        }
        .button-container {
            position: absolute;
            top: 0;
            left: -10px;
            cursor: pointer;
        }
        .content {
            margin-left: 10px;
        }
        .json-object {
            background-color: #2d2d30;
        }
        .json-array {
            background-color: #333337;
        }
        .json-key {
            color: #9cdcfe; /* light blue */
        }
        .json-string {
            color: #ce9178; /* light orange/brown */
        }
        .json-number {
            color: #b5cea8; /* light green */
        }
        .json-boolean {
            color: #569cd6; /* a different blue */
        }
        .json-null {
            color: #808080; /* gray */
        }
        .hidden {
            display: none;
        }
        .collapser {
            cursor: pointer;
            margin-right: 5px;
            color: #808080;
        }
        .collapser:hover {
            color: #d4d4d4;
        }
    </style>
</head>
<body>
    <h1>Hello, World!</h1>
    <p>Click the button to send a POST request.</p>
    <form id="post-form" method="POST" action="/">
        <button type="submit">Send POST Request</button>
    </form>
    <div id="json-renderer"></div>

    <script>
        document.getElementById('post-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ request: "state" }) 
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // The server sends back a JSON document embedded in an HTML page
                // We need to extract it. A simple way is to get the text content.
                return response.text();
            })
            .then(html => {
                const renderer = document.getElementById('json-renderer');
                renderer.innerHTML = '';
                try {
                    // Try to find JSON within the <pre> tag like in j.html
                    const pre_content = html.match(/<pre>([\s\S]*)<\/pre>/);
                    if(pre_content && pre_content[1]){
                        const json = JSON.parse(pre_content[1]);
                        const visualizer = createJsonVisualizer(json);
                        renderer.appendChild(visualizer);
                    } else {
                        // Fallback for non-json or different html structure
                        renderer.textContent = "Could not find JSON in the response.";
                    }
                } catch (e) {
                    console.error('Error parsing JSON:', e);
                    const renderer = document.getElementById('json-renderer');
                    renderer.textContent = 'Error parsing JSON from response.';
                }
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
                const renderer = document.getElementById('json-renderer');
                renderer.textContent = 'Error fetching data.';
            });
        });

        function createJsonVisualizer(data) {
            if (data === null) {
                const element = document.createElement('span');
                element.className = 'json-null';
                element.textContent = 'null';
                return element;
            }

            const type = typeof data;
            if (type === 'string') {
                const element = document.createElement('span');
                element.className = 'json-string';
                element.textContent = `"${data}"`;
                return element;
            }
            if (type === 'number') {
                const element = document.createElement('span');
                element.className = 'json-number';
                element.textContent = data;
                return element;
            }
            if (type === 'boolean') {
                const element = document.createElement('span');
                element.className = 'json-boolean';
                element.textContent = data;
                return element;
            }

            if (type === 'object') {
                const container = document.createElement('div');
                const isArray = Array.isArray(data);
                container.className = isArray ? 'json-array' : 'json-object';

                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'button-container';

                const collapser = document.createElement('span');
                collapser.className = 'collapser';
                collapser.textContent = '▼';
                buttonContainer.appendChild(collapser);

                container.appendChild(buttonContainer);
                
                const content = document.createElement('div');
                content.className = 'content';
                container.appendChild(content);

                if (isArray) {
                    data.forEach((value, index) => {
                        const item = document.createElement('div');
                        item.appendChild(createJsonVisualizer(value));
                        if(index < data.length -1) {
                            item.append(',');
                        }
                        content.appendChild(item);
                    });
                } else {
                    const keys = Object.keys(data);
                    keys.forEach((key, index) => {
                        const row = document.createElement('div');
                        
                        const keySpan = document.createElement('span');
                        keySpan.className = 'json-key';
                        keySpan.textContent = `${key}: `;
                        row.appendChild(keySpan);
                        
                        row.appendChild(createJsonVisualizer(data[key]));

                        if(index < keys.length - 1) {
                           row.append(',');
                        }

                        content.appendChild(row);
                    });
                }
                
                collapser.addEventListener('click', (e) => {
                    e.stopPropagation();
                    content.classList.toggle('hidden');
                    collapser.textContent = content.classList.contains('hidden') ? '▶' : '▼';
                });

                return container;
            }

            const element = document.createElement('span');
            element.textContent = data.toString();
            return element;
        }
    </script>
</body>
</html>